@using Sandbox;
@using Sandbox.UI;
@using TacticsRPG;
@inherits Panel
@namespace Sandbox

<root>
	@if(!IsActive) return;
	<div class = "skill-menu" @ref="Menu">
		@foreach(CommandItem skill in BattleManager.Instance.ActiveUnit.Turn.SkillCommands)
		{
			if(skill.Active)
			{
				<div class="button" style ="@( BattleManager.Instance.ActiveUnit.Turn.SkillCommands.IndexOf(skill) == SelectedIndex ? "background-color: green" : "background-color: blue")">
					<h1 class="button-text">@skill.Text</h1>
				</div>
			}
			else if(!skill.Active)
			{
				<div class="button" style ="background-color: gray">
					<h1 class="button-text">@skill.Text</h1>
				</div>		
			}
		}
	</div>
</root>

@code
{
	//CONDENSE ALL ABILITYITEM MENUS TO ONE MENU!!! (SKILL, SPELL, ITEM)

	public bool IsActive = false;
	public bool IsGrey = false;
	public int MenuDepth = 3;
	public Panel Menu;
	public int SelectedIndex = 0;

	public void Activate()
	{
		IsActive = true;
	}

	public void Deactivate()
	{
		IsActive = false;
	}

	public void IncreaseIndex()
	{
		if(SelectedIndex == BattleManager.Instance.ActiveUnit.Turn.SkillCommands.Count() - 1)
		{
			Log.Info("Out Of Range");
			return;
		}
		SelectedIndex += 1;

		StateHasChanged();
		Log.Info($"ItemMenu Index Set To {SelectedIndex}");
	}

	public void DecreaseIndex()
	{
		if(SelectedIndex == 0)
		{
			Log.Info("Out Of Range");
			return;
		}		
		SelectedIndex -= 1;
		StateHasChanged();
		Log.Info($"ItemMenu Index Set To {SelectedIndex}");
	}

	public void SelectMenuItem()
	{
		PlayerMaster.Instance.SelectedCommand(CommandType.Skill, BattleManager.Instance.ActiveUnit.Turn.SkillCommands[SelectedIndex]);
		Log.Info($"{BattleManager.Instance.ActiveUnit.Turn.SkillCommands[SelectedIndex].Text} Selected");
	}

	protected override int BuildHash() => System.HashCode.Combine(RealTime.Now);
}
